1.How many olympics games have been held?
select count(distinct games) as total_no_olympic_games
from
athlete_events


2. List down all Olympics games held so far.
select distinct year, season, city
from
athlete_events


3.Mention the total no of nations who participated in each olympics game?
select a.Games, count( distinct n.region)
from
athlete_events a
join noc_regions n
on a.NOC = n.NOC
group by Games


4. Which year saw the highest and lowest no of countries participating in olympics
with cte as (select a.Games, count( distinct n.region) as pn
from
athlete_events a
join noc_regions n
on a.NOC = n.NOC
group by Games)

select distinct concat( first_value(Games) over( order by pn desc),'-',first_value(pn) over( order by pn desc)) as highest_countries
,concat( first_value(Games) over( order by pn ),'-',first_value(pn) over( order by pn)) as lowest_countries
from cte


5. Which nation has participated in all of the olympic games
with cte as(select Games,NOC,count(distinct NOC) as pt
from
athlete_events
group by Games, NOC)
,countr as (select n.region, sum(c.pt) as total_participated_games
from
cte c
join noc_regions n
on c.noc = n.noc
group by n.region
order by sum(c.pt) desc)

select * from
countr 
where total_participated_games = (select count(distinct Games) 
from
athlete_events)


6. Identify the sport which was played in all summer olympics.
with cte as (select distinct year, sport
from
athlete_events
where season = 'summer'
order by year)
,kte as (select sport, count(sport) as palyedinsum
from
cte
group by sport)

select sport,palyedinsum
from
kte
where palyedinsum =(select count(distinct year)
from
athlete_events
where season = 'summer')


7. Which Sports were just played only once in the olympics.
with t1 as(select distinct games, sport 
from
athlete_events)
,t2 as(select sport, count(sport) as no_of_games
from
t1
group by sport)

select t2.*, t1.games
from
t2
join t1
on t2.sport = t1.sport
where t2.no_of_games =1


8. Fetch the total no of sports played in each olympic games.
select games, count(distinct sport) as no_of_sports
from
athlete_events
group by games
order by count(distinct sport) desc, games


9. Fetch oldest athletes to win a gold medal
SELECT *
FROM athlete_events
where medal like'%Gold%'
and age=(select max(age) as age
from
athlete_events
where medal like'%Gold%'
and age not like '%NA%')


10. Find the Ratio of male and female athletes participated in all olympic games.
with cte as (select 
(select count(distinct id) from athlete_events where sex = 'M') as M,
(select count(distinct id) from athlete_events where sex = 'F') as F)

select concat("1",":",round(M/F,2)) as Sex_ratio from cte


11. Fetch the top 5 athletes who have won the most gold medals.
with cte as(select Name, count(Medal) as medals_won, dense_rank() over (order by count(Medal) desc) as rk
from
athlete_events
where Medal like '%Gold%'
group by Name
order by count(Medal) desc)

select Name, medals_won
from
cte
where rk<=5


12. Fetch the top 5 athletes who have won the most medals (gold/silver/bronze).
with cte as(select name,team, count(medal) as medals_won, dense_rank() over(order by count(medal) desc) as rk
from
athlete_events
where medal not like '%NA%'
group by name,team
order by count(medal) desc)

select name, team, medals_won
from
cte
where rk<=5


13. Fetch the top 5 most successful countries in olympics. Success is defined by no of medals won.
with cte as(select Noc, count(medal) as medals_won, dense_rank() over(order by count(medal) desc) as rk
from
athlete_events
where medal not like '%NA%'
group by Noc
order by count(medal) desc)

select n.region, c.medals_won
from
cte c
join noc_regions n
on c.noc = n.noc
where rk<=5


14. List down total gold, silver and bronze medals won by each country.
with cte as(select noc,case when medal like '%Gold%' then 1 else 0 end as Gold
,case when medal like '%Silver%' then 1 else 0 end as Silver
,case when medal like '%bronze%' then 1 else 0 end as bronze
from athlete_events)

select n.region,sum(c.gold) as gold, sum(c.silver) as silver, sum(c.bronze) as bronze
from
cte c
join noc_regions n
on c.noc = n.noc
group by n.region
order by sum(c.gold)desc, sum(c.silver) desc , sum(c.bronze) desc


15. List down total gold, silver and bronze medals won by each country corresponding to each olympic games.
with cte as(select games,noc,case when medal like '%Gold%' then 1 else 0 end as Gold
,case when medal like '%Silver%' then 1 else 0 end as Silver
,case when medal like '%bronze%' then 1 else 0 end as bronze
from athlete_events)

select c.games,n.region as country,sum(c.gold) as gold, sum(c.silver) as silver, sum(c.bronze) as bronze
from
cte c
join noc_regions n
on c.noc = n.noc
group by c.games,n.region
order by c.games


16. Identify which country won the most gold, most silver and most bronze medals in each olympic games.
with cte as(select a.games, n.region, a.medal
from
athlete_events a
join noc_regions n
on a.noc = n.noc
where medal not like '%NA%')
,
pte as(select games,region,sum( case when medal like '%gold%' then 1 else 0 end) as gold
,sum( case when medal like '%silver%' then 1 else 0 end) as silver
,sum( case when medal like '%bronze%' then 1 else 0 end) as bronze
from
cte
group by games,region
order by games)

select distinct games,concat( first_value(region) over(partition by games order by gold desc),'_', first_value(gold) over(partition by games order by gold desc)) as max_gold
,concat( first_value(region) over(partition by games order by silver desc),'_'
, first_value(silver) over(partition by games order by silver desc)) as max_silver,
concat( first_value(region) over(partition by games order by bronze desc),'_'
, first_value(bronze) over(partition by games order by bronze desc)) as max_bronze
from
pte


17. Which countries have never won gold medal but have won silver/bronze medals?
with cte as(select a.games, n.region, a.medal
from
athlete_events a
join noc_regions n
on a.noc = n.noc
where medal not like '%NA%')
,
pte as(select region,sum( case when medal like '%gold%' then 1 else 0 end) as gold
,sum( case when medal like '%silver%' then 1 else 0 end) as silver
,sum( case when medal like '%bronze%' then 1 else 0 end) as bronze
from
cte
group by region
order by region)

select region as country, gold, silver,bronze
from
pte
where gold = 0


18.In which Sport/event, India has won highest medals.
with cte as(select sport, count(medal) as total_medals
from
athlete_events
where medal not like '%NA%'
and team = 'india'
group by sport
order by count(medal) desc),
pte as(select sport,total_medals, dense_rank() over(order by total_medals desc) as rk
from
cte)
select sport,total_medals
from pte
where rk=1


19. Break down all olympic games where India won medal for Hockey and how many medals in each olympic games
select team,sport, games,count(medal) as total_medals
from
athlete_events
where medal not like '%NA%'
and team = 'india'
and sport ='hockey'
group by team,sport, games
order by count(medal) desc

